name: Tests

on: [push]

jobs:
  hadolint:
    name: Check docker images (Hadolint)
    runs-on: ubuntu-latest
    container: hadolint/hadolint
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
      - name: Checking image Best Practices
        run: hadolint Dockerfile

  test_unit:
    name: Run unit test (PHPUnit)
    runs-on: ubuntu-latest
    container: tlacheheb/blog_php
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
      - name: install composer package
        run: composer install
      - name: start test
        run: bin/phpunit

  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Ruby 2.6
      uses: actions/setup-ruby@v1
      with:
        ruby-version: 2.6.x
    - name: deploy site
      env:
        app_name_heroku: ${{ secrets.HEROKU_APP }}
        token_heroku: ${{ secrets.HEROKU_STAGING_API_KEY }}
      run: |
        gem install dpl
        dpl --provider=heroku --app=$app_name_heroku --api-key=$token_heroku